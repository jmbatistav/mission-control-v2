{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/pipo/mission-control-v2/src/app/api/memories/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\nconst WORKSPACE = process.env.MEMORY_PATH || path.join(process.env.HOME || \"\", \".openclaw/workspace\");\nconst MEMORY_DIR = path.join(WORKSPACE, \"memory\");\nconst MEMORY_FILE = path.join(WORKSPACE, \"MEMORY.md\");\n\nexport interface MemoryDocument {\n  id: string;\n  filename: string;\n  title: string;\n  content: string;\n  type: \"core\" | \"daily\" | \"config\";\n  date?: string;\n  size: number;\n  lastModified: number;\n}\n\nfunction classifyFile(filename: string): { type: MemoryDocument[\"type\"]; title: string; date?: string } {\n  if (filename === \"MEMORY.md\") {\n    return { type: \"core\", title: \"Core Memory â€” Long-term Knowledge\" };\n  }\n  const dateMatch = filename.match(/^(\\d{4}-\\d{2}-\\d{2})\\.md$/);\n  if (dateMatch) {\n    const d = new Date(dateMatch[1] + \"T12:00:00\");\n    const formatted = d.toLocaleDateString(\"en-US\", { weekday: \"long\", month: \"long\", day: \"numeric\", year: \"numeric\" });\n    return { type: \"daily\", title: formatted, date: dateMatch[1] };\n  }\n  const name = filename.replace(/\\.md$/, \"\").replace(/-/g, \" \").replace(/\\b\\w/g, (c) => c.toUpperCase());\n  return { type: \"config\", title: name };\n}\n\nexport async function GET() {\n  try {\n    const docs: MemoryDocument[] = [];\n\n    // Read MEMORY.md\n    try {\n      const content = await fs.readFile(MEMORY_FILE, \"utf-8\");\n      const stat = await fs.stat(MEMORY_FILE);\n      const info = classifyFile(\"MEMORY.md\");\n      docs.push({\n        id: \"MEMORY.md\",\n        filename: \"MEMORY.md\",\n        title: info.title,\n        content,\n        type: info.type,\n        size: stat.size,\n        lastModified: stat.mtimeMs,\n      });\n    } catch {}\n\n    // Read memory/ directory\n    try {\n      const files = await fs.readdir(MEMORY_DIR);\n      for (const file of files) {\n        if (!file.endsWith(\".md\")) continue;\n        try {\n          const filePath = path.join(MEMORY_DIR, file);\n          const content = await fs.readFile(filePath, \"utf-8\");\n          const stat = await fs.stat(filePath);\n          const info = classifyFile(file);\n          docs.push({\n            id: file,\n            filename: file,\n            title: info.title,\n            content,\n            type: info.type,\n            date: info.date,\n            size: stat.size,\n            lastModified: stat.mtimeMs,\n          });\n        } catch {}\n      }\n    } catch {}\n\n    // Sort: core first, then daily desc, then config\n    docs.sort((a, b) => {\n      if (a.type === \"core\") return -1;\n      if (b.type === \"core\") return 1;\n      if (a.type === \"daily\" && b.type === \"daily\") return (b.date ?? \"\").localeCompare(a.date ?? \"\");\n      if (a.type === \"daily\") return -1;\n      if (b.type === \"daily\") return 1;\n      return a.title.localeCompare(b.title);\n    });\n\n    return NextResponse.json({ documents: docs });\n  } catch (err) {\n    return NextResponse.json({ error: \"Failed to read memories\", documents: [] }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}